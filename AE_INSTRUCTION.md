# Instructions to reproduce the evaluations of the paper

Here are the detailed instructions to perform the same experiments in our paper.

## Artifact claims

We claim that the results might differ from those in our paper due to various factors (e.g., cluster sizes, machines, OS, software packages, etc.). Nevertheless, we expect DMTree to still achieve similar performance (in normal operations) with Cassandra while significantly reducing storage overhead (i.e., our main results). In addition, to reduce the influence of cloud storage location, hardware requirement, complexity, and running time of the evaluation, we made some changes to the evaluation configurations.

## Cluster setup

* We require **six compute nodes** and **one memory node** in AE.
* We provide a server cluster consisting of 7 nodes (skv-node1 to skv-node7) for reproducing the experiments in our paper. One node, `skv-node7`, will be made available as the jump host for accessing the cluster and as the main node for running the reproduction scripts. The AEC can submit their SSH public key via the following document: XXX. Once we have added the key to the server, node7 can be accessed using the following command:`ssh -P 6672 aefast26@222.195.68.87`.
* We sincerely apologize that, due to limited cluster resources, we are unable to provide each AEC with an independent execution environment. To prevent potential conflicts caused by concurrent usage, we have adopted a document-based reservation system along with an exclusive access notification mechanism in the following steps, ensuring that only one AEC can run experiments at any given time. 
* Additionally, to avoid excessive redundant testing, we will indicate which experiments have already been executed and have results available. It will be up to the AEC to decide whether to rerun those parts.

## Environment setup (~20 minutes)

We provide scripts to set up the environment for the evaluation, including cloning the code repository and copying and compiling it across multiple cluster nodes. The scripts are tested on Ubuntu 20.04 LTS. 

**Step 1:** Clone the code repository `aefast26`.

```shell
git clone https://github.com/muouim/aefast26.git
```

**Step 2:** Run the following script on `skv-node7`, including copying and compiling the code across multiple cluster nodes.

```shell
cd aefast26
bash build_ae.sh
```

To prevent repeated compilation and concurrent execution from disrupting the established environment, we have implemented a tracking and checking mechanism for the environment setup status when running the `build_ae.sh` script:

- If the script has not been executed before and the code has not been copied or compiled, the script will be executed.
- If the script is currently being executed by another AEC, a message will prompt: ”`The script is already running, please wait.`“
- If the script has already been executed, a message will prompt: "`Environment setup is complete, no need to run the script again.`"
- If AEC want to re-run the environment setup (some unexpected issues or something went wrong), please run `rm /tmp/build_ae.flag` the reset the environment setup status.

## Evaluations

This section describes how to reproduce the evaluations in our paper. To simplify the reproduction process, we provide Ansible-based scripts to run all major experiments. The script will automatically run the experiments and generate the result logs. The scripts will take about 9~10 days to finish all the experiments.

- **We suggest running the scripts of Exp#0 first, which can reproduce the main results of our paper while including most of the functionality verification (i.e., achieve controllable storage saving compared with Cassandra; provide similar performance of different types of KV operations such as read, write, scan, and update)**.

### Note on the experiment scripts

These evaluation scripts require a long time to run. To avoid the interruption of the experiments, we suggest running the scripts in the background with `tmux`, `nohup`, `screen`, etc. In addition, please make sure that all scripts have been given execution permissions. You can do this according to the following example:

```shell
cd scripts
find . -type f -name "*.sh" -exec chmod +x {} \;
```

### Note on the evaluation results

The raw running log generated by the YCSB benchmark tool will be stored in the folder `${PathToELECTResultSummary}/` configured in the `scripts/settings.sh` file. The log file will be named with detailed configuration information, such as workload, KV number, operation number, etc.

To make the result easier to read, we provide the summarized result of each evaluation in the `scripts/exp/` folder and named `${ExpName}.log`. For example, the result of Exp#1 will be stored in `scripts/exp/Exp1-ycsb.log`.

For the **performance evaluation**, the result will be summarized in different ways according to the running round number of the experiment (defined in each of the experiment scripts by the variable `RunningRoundNumber`).

* If the running round number is 1, the result will be directly output as in the example shown below.

```shell
[Exp info] scheme: elect, workload: Write, KVNumber: 600000, OPNumber: 60000, KeySize: 24, ValueSize: 1000, ClientNumber: 16, ConsistencyLevel: ONE, ExtraFlag: 
Throughput (unit: op/s): 
Only one round: 9992.38
[READ] Average operation latency (unit: us):
Only one round: 1369.53
[READ] 99th percentile latency (unit: us):
Only one round: 1883.00
```

For **other evaluations (i.e., Exp#3, 4, and 5)**, the result will be summarized similarly to the summarized performance results. Again, depending on the number of running rounds conducted, the output formats include options such as a single-round summary (run experiment with one round) or more comprehensive data sets featuring average, maximum, and minimum values (run experiment with 2~4 rounds), as well as average values with a 95% Student-T distribution confidence interval (run experiment more than five rounds). We provide examples of the summarized results of operation breakdown, recovery time cost, and resource usage in each related evaluation.

### Simple experiment (For quick verification)

#### Exp#0: Simple experiment (~ 6 hours)

We provide this simple experiment to verify our main experimental results quickly: **TODO: DMTree provides XXX...... similar performance compared to Cassandra while significantly reducing hot-tier storage overhead.** Specifically, we use 10M KV pairs and 1M KV operations (including read/write/update/scan, consistent with Exp2). This experiment will provide storage overhead (main results of Exp#1,2), performance of normal and degraded operations (main results of Exp#2), KV operation breakdown (main results of Exp#3), recovery time overhead when a single node fails (main results of Exp#4), and average resource utilization under load/normal/degraded conditions (main results of Exp#5). The summarized results will be printed on the screen after the evaluation and saved in the `scripts/exp/Exp0-simpleOverall.log` file.

You can run this simple experiment via the following command:

```shell
bash run_simple.sh
nohup bash run_simple.sh >run_simple.output 2>&1 &
```

To prevent repeated experiments and concurrent execution from disrupting the running experiments, we have implemented a tracking and checking mechanism for the simple experiment status when running the `run_simple.sh` script:

- If the script has not been executed before and the code has not been copied or compiled, the script will be executed.
- If the script is currently being executed by another AEC, a message will prompt: ”`The script is already running, please wait.`“
- If the script has already been executed, a message will prompt: "`Simple experiment is complete, no need to run the script again.`".
- If AEC want to re-run the simple experiment (some unexpected results or something wrong), please run `rm /tmp/simple_exp.flag` the reset the simple experiment status.

The results will be output in the file `simple_results.csv`. Here, we only show the title line and output sequence of each part. The specific result format of each part is as shown in the "Note on the evaluation results" above and the example of each specific experiment below.

```shell
Index,Workload,Total,Node1,Node2,Node4,Node5,Node6,Node7
dmtree,ycsb-c,53.10896,9.01745,8.88033,8.3974,8.90831,9.18188,8.72359
dmtree,insert-only,26.03086,4.22692,4.49647,4.2974,4.29571,4.43153,4.28283
dmtree,update-only,29.37954,4.88428,4.99175,4.52919,5.08371,5.05395,4.83666
dmtree,scan-only,3.419791,0.56917,0.571074,0.567664,0.570717,0.570537,0.570629
fptree,ycsb-c,26.43315,4.33411,4.39609,4.42018,4.4047,4.4433,4.43477
fptree,insert-only,14.01274,2.32656,2.35896,2.32702,2.33644,2.33624,2.32752
fptree,update-only,14.837250000000001,2.45573,2.47846,2.46987,2.47413,2.47883,2.48023
fptree,scan-only,2.660171,0.44338,0.443395,0.442956,0.443469,0.443526,0.443445
sherman,ycsb-c,9.808539999999999,1.63502,1.6351,1.63325,1.63514,1.63513,1.6349
sherman,insert-only,5.976302,0.997505,0.997568,0.996693,0.996444,0.994714,0.993378
sherman,update-only,1.849818,0.308353,0.307522,0.30745,0.308783,0.308824,0.308886
sherman,scan-only,2.989694,0.498344,0.498363,0.497923,0.498349,0.498357,0.498358
smart,ycsb-c,52.60434,7.05895,9.17384,8.28245,9.30797,9.43038,9.35075
smart,insert-only,11.144329999999998,1.76615,1.97517,1.42142,1.85197,2.14946,1.98016
smart,update-only,24.482090000000003,3.62905,4.24562,4.02303,4.15574,4.1914,4.23725
smart,scan-only,1.1028170000000002,0.183401,0.185141,0.182591,0.183932,0.184405,0.183347
rolex,ycsb-c,11.34924,1.89276,1.89276,1.8856,1.89288,1.89283,1.89241
rolex,insert-only,7.06654,1.17809,1.17811,1.17585,1.17815,1.17824,1.1781
rolex,update-only,7.901050000000001,1.31637,1.31613,1.31677,1.31702,1.31701,1.31775
rolex,scan-only,3.3808359999999995,0.563909,0.563831,0.561675,0.563897,0.563796,0.563728
dlsm,ycsb-c,0.0
dlsm,insert-only,0.0
dlsm,update-only,0.0
dlsm,scan-only,0.0
chime,ycsb-c,41.53806999999999,6.68784,6.88953,7.01766,6.90815,7.15323,6.88166
chime,insert-only,7.44403,1.2343,1.24395,1.2436,1.24482,1.23669,1.24067
chime,update-only,18.59094,3.09973,3.08964,3.09549,3.09294,3.10763,3.10551
chime,scan-only,2.6964639999999997,0.44428,0.452267,0.447103,0.448102,0.45074,0.453972
```

该实验结果对应论文中的Fig12中的瓶颈实验结果，为了快速进行实验的验证，我们仅提供了瓶颈性能（最大线程数量下的各basline的各负载性能，对应图中标红框内的数据点，转换为了柱状图）

原文中的overall实验如图所示，红框内为simple实验输出的实验数据，对应最大线程数量下的各basline的各负载性能

![image-20250617173455219](.\AE_INSTRUCTION.assets\image-20250617173455219.png)

输出的柱状图如下

<img src=".\AE_INSTRUCTION.assets\image-20250617173803989.png" alt="image-20250617173803989" style="zoom: 25%;" />

如果卡住了，请取消脚本，运行如下脚本，清除各个服务器上运行的程序，并从卡住的地方尝试重新运行

- 协程判定退出的时候，会存在一些卡住的情况？还是server掉了

```
nohup: ignoring input
---------- Phase 0: Check script running status ----------
Script started at: Tue 17 Jun 2025 01:41:34 AM UTC
This script has not been run before, starting the execution...
---------- Phase 1: Run simple experiment for each baseline ----------
Running experiment for DMTree
Finished DMTree
DMTree's results are output to /home/aefast26/aefast26/simple.output
Time after DMTree: Tue 17 Jun 2025 02:12:27 AM UTC, Elapsed time: 30.88 minutes
Transaction throughput data has been saved to simple_results.csv
Running experiment for FPTree
Finished FPTree
FPTree's results are output to /home/aefast26/aefast26/simple.output
Time after FPTree: Tue 17 Jun 2025 02:51:18 AM UTC, Elapsed time: 1.16 hours
Transaction throughput data has been saved to simple_results.csv
Running experiment for Sherman
Finished Sherman
Sherman's results are output to /home/aefast26/aefast26/simple.output
Time after Sherman: Tue 17 Jun 2025 03:58:20 AM UTC, Elapsed time: 2.27 hours
Transaction throughput data has been saved to simple_results.csv
Running experiment for SMART
Finished SMART
SMART's results are output to /home/aefast26/aefast26/simple.output
Time after SMART: Tue 17 Jun 2025 05:26:09 AM UTC, Elapsed time: 49.21 minutes
Transaction throughput data has been saved to simple_results.csv
Running experiment for ROLEX
Finished ROLEX
ROLEX's results are output to /home/aefast26/aefast26/simple.output
Time after ROLEX: Tue 17 Jun 2025 06:17:24 AM UTC, Elapsed time: 1.67 hours
Transaction throughput data has been saved to simple_results.csv
Running experiment for CHIME
Finished CHIME
CHIME's results are output to /home/aefast26/aefast26/simple.output
Time after CHIME: Tue 17 Jun 2025 07:03:30 AM UTC, Elapsed time: 2.44 hours
Transaction throughput data has been saved to simple_results.csv
Running experiment for dLSM

```

### Overall system analysis (Exp#11~14 in our paper)

#### Exp#11-#12: Performance with Micro-benchmarks (1 human minutes + ~ 20 compute-hours)

*Running:*

```shell
bash run_overall.sh
```

#### Exp#14: Performance with YCSB core workloads (1 human-minutes + ~ 5 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp2-operations.sh
```

#### Exp#13: Tail latency with Micro-benchmarks (1 human-minutes + ~ 5 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp3-breakdown.sh
```

*Results:* These summaries are available in the `scripts/exp/` directory and can be found in the file named `Exp3-breakdown.log`. For example, the write operation breakdown result of ELECT will be output as in the example shown below. Note that the title for each metric is the same as the title in the paper.

```shell
[Breakdown info for Write] scheme: elect, KVNumber: 6000000, KeySize: 24, ValueSize: 1000
WAL (unit: ms/MiB):
Only one round: 388.95
MemTable (unit: ms/MiB):
Only one round: 686.65
Flushing (unit: ms/MiB):
Only one round: 200.79
Compaction (unit: ms/MiB):
Only one round: 1638.06
Transitioning (unit: ms/MiB):
Only one round: 259.84
Migration (unit: ms/MiB):
Only one round: 17.72
...
```

### Parameter analysis (Exp#6~8 in our paper)

#### Exp#4: Full-node recovery (1 human-minutes + ~ 14 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp4-recovery.sh
```

*Results:* These summaries are available in the `scripts/exp/` directory and can be found in the file named `Exp4-recovery.log`.

* For ELECT, the recovery time is the time cost of retrieving the LSM-trees from the replication nodes and decoding the SSTables. The result will be output as in the example shown below.

```shell
[Exp info] scheme: elect, KVNumber: 6000000, KeySize: 24, ValueSize: 1000
Total recovery time cost (unit: s):
Average: 6653.00, Min: 6653, Max: 6653
Recovery time cost for retrieve LSM-trees (unit: s):
Average: 3442.00, Min: 3442, Max: 3442
Recovery time cost for decode SSTables (unit: s):
Average: 3211.00, Min: 3211, Max: 3211
```

* For Cassandra, the recovery time is the time cost of retrieving the SSTables from the replication only. The result will be output as in the example shown below.

```shell
[Exp info] scheme: cassandra, KVNumber: 6000000, KeySize: 24, ValueSize: 1000
Total recovery time cost (unit: s):
Only one round: 7515.00
```

#### Exp#5: Resource usage (1 human-minutes + ~ 5 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp5-resource.sh
```

*Results:* We summarize resource utilization as the 95th percentile of CPU usage, the 95th percentile of total memory overhead, total disk I/O, and total network overhead (bidirectional). In particular, we obtain the 95% percentile CPU usage based on the sum of the CPU usage of all nodes with the same timestamp and then calculate the average usage of each core (i.e., total usage/total number of cores). Therefore, the CPU usage results will be significantly affected by the differences in hardware configurations of different testbeds. The results will be output as in the example shown below.

```
[Resource usage with degraded operations] scheme: elect, KVNumber: 6000000, KeySize: 24, ValueSize: 1000, OPNumber: 600000
95%-percentile CPU Usage (%):
Only one round: 1.19
95%-percentile RAM Usage (GiB):
Only one round: 22.98
Total Disk I/O (GiB):
Only one round: 1.08
Total Network traffic (GiB):
Only one round: 202.38
```

#### Exp#6: Impact of key and value sizes (1 human-minutes + ~ 40 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp6-kvSize.sh
```

#### Exp#7: Impact of storage-saving target (1 human-minutes + ~ 45 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp7-balanceParam.sh
```

#### Exp#8: Impact of erasure coding parameters (1 human-minutes + ~ 12 compute-hours)

The original experiment requires at least 12 nodes (1 client node, 10 server nodes, and 1 storage node). For the provided testbeds, limited by the number of available nodes, we adapt the changing range of erasure code K from 4~8 to 2~4. This result only verifies ELECT's adaptability to different K values.

*Running:*

```shell
bash scripts/exp/Exp8-ecParam.sh
```

### System setting analysis (Exp#9,10 in our paper)

#### Exp#9: Impact of read consistency level (1 human-minutes + ~ 5 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp9-consistency.sh
```

#### Exp#10: Impact of number of clients (1 human minutes + ~ 5 compute-hours)

*Running:*

```shell
bash scripts/exp/Exp10-clients.sh
```
